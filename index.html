
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   
    <title>TwitterMap </title>


	<script src="utils.js" ></script> 
        <script src="tether.js" ></script> 

    <script type='text/javascript' src='jquery.min.js'></script>

    <link rel="stylesheet" type="text/css" href="jquery-ui.css">
     <script type='text/javascript' src="jquery-ui.js"> </script>

    <script src="bootstrap.min.js"></script>
   
    <link rel="stylesheet" href="bootstrap.min.css.map">
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="font-awesome.min.css">
    <link rel = "stylesheet" type="text/css" href="ZC.css">

         <script src="touchPunch.js"></script>
       
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


  </head>
  <body>

 

<div class="container-fluid">
 
<nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse">
  <button class="navbar-toggler navbar-toggler-right " type="button" data-toggle="collapse" data-target="#navbarSupportedContent" >
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="//siHome">SI</a>
  
  
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto" id="nList">
      <li class="nav-item active">
        <a class="nav-link" href="#">TweetMap</a>
      </li>
       
      </ul>
   </div>
  </nav>
 
</div>

    <div class="container-fluid" id="topBar">
      <h1 id="mapInst">Select a location on the map to see its address information and local twitter feed</h1>
    </div>

<div class="container-fluid" id="mapSide">
    <div class="container" id="mapWrap">
      
        <div class="container" id="map">
        </div> 
        <div class="ui-resizable-handle ui-resizable-se" id="segrip">          
        </div>   
    </div>
</div>

<div class="container-fluid formDiv" >
  <div id="head2Wr">
    <h2>Search for a Local Twitter Feed by Address</h1>
  </div>

  <div class="container-fluid" id="innerForm">
    <form id='addForm'>
      <div class="form-group">
        <label for="address">Enter Partial Address</label>
        <input type="text" class="form-control" id="address" placeholder="e.g. 579 underhill ave." name='parAddress'>
        <small id="addHelp" class="form-text text-muted"></small>
      </div>  
      <button type="submit" class="btn btn-primary" id="findAddress">Submit</button>
    </form>
  </div>
 <div id="successDiv">
</div>
</div>



<div class = "container-fluid" id="twitFeed" >
  <h3 id = "resTitle"> </h3>
</div>

<div class="container-fluid formDiv justify-content-center" id="sOpt" >
  
      <button class="btn btn-primary" id="rsTog" type="button" data-toggle="collapse" data-target="#Scol" aria-expanded="false" aria-controls="collapseExample">
        Refine Your Search!
      </button>
      <br><br>
<div class="collapse justify-content-center" id="Scol">
<br>
<h2>Specify your Search terms</h2>
<br>
 <form id="reForm" method="POST">
    <div class="form-group">
     <label for="radSel">Look for tweets within&nbsp&nbsp </label>
      <select class="custom-select-lg" id="radSel">
        <option value=".5mi">.5 miles</option>
        <option value="1mi">1 miles</option>
        <option selected value="3mi">3 miles</option>
         <option value="7mi">7 miles</option>
          <option value="15mi">15 miles</option>
           <option value="30mi">30 miles</option>
            <option value="100mi">100 miles</option>
            <option value="500mi">500 miles</option>
            <option value="1000mi">1000 miles</option>
      </select>
       <label for="radSel">&nbsp&nbsp of the map marker</label>
    </div>
    <div class="form-group">
    <label for="countSel">Choose the maximum number of Tweets to view per request&nbsp&nbsp </label>
        <select class="custom-select-lg" id="countSel">
            <option selected value="3">3 tweets</option>
            <option>10 tweets</option>
            <option>15 tweets</option>
            <option>25 tweets</option>
            <option>40 tweets</option>
            <option>60 tweets</option>
            <option>100 tweets</option>
          </select>
    </div>  
     <div class= "row justify-content-center">
      <label for="textSearch" class="col-form-label">Search with Keyword(s) ?</label>
      <div class="col-4">
        <input class="form-control" type="text" value="" placeholder="e.g. 'Music Science'" id="textSearch">
        </div>
      </div>   
    <br>
    <button type="submit" class="btn btn-primary" id="refineSubmit">Search Feed!</button>
  </form>
 </div>
</div>
<a href="#feedZone"></a>
  <div id="twitterFeed" class="row justify-content-center">
  </div>
</div>

<div id="footer">
</div>
 <script type="text/javascript" src="../navStyle.js"></script>
  
  <script>

  $("#rsTog").click(function(){
  $(this).toggleClass("open");
  if($(this).hasClass("open")==true){
   $(this).text("Hide Refine Feed Search Menu");
   $(this).css("color", "orange");
   $(this).mouseover(function(){
   $(this).css("color", "white")
  });
   $("#sOpt").css("padding-right", "30px");
   $("#Scol").css("border","4px solid #428BC0");
   $("#Scol").css("margin","4px");
   $("#Scol").css("border-radius","3px");
   $("#Scol").css("width","100%");
   $("#Scol").css("padding","15px 5px 15px 5px");
   $("#Scol").css("margin","5px 15px 5px 15px");
   $("#Scol").css("background-color","white");
   $("#Scol").css("color","black");      
}
 if($(this).hasClass("open")==false){
    $(this).text("Refine Your Feed!");
    $(this).css("color", "white");
 }
});



// ex geocoder request
// var address = "123 test drive"
//       function geo() {
//   var lat = homeMarker.getPosition().lat();
//   var lng = homeMarker.getPosition().lng();
//   var geocoder = new google.maps.Geocoder();
//   geocoder.geocode({
//     'address': address
//   }, function(results, status) {
//     if (status == google.maps.GeocoderStatus.OK) {
//       var Lat = results[0].geometry.location.lat();
//       var Lng = results[0].geometry.location.lng();
//       var myOptions = {
//         zoom: 11,
//         center: new google.maps.LatLng(Lat, Lng)
//       };
//       var map = new google.maps.Map(
//         document.getElementById("map"), myOptions);
//     } else {
//       alert("Something went wrong " + status);
//     }
//   });
// };
 
var emap;

var map;

var mapDiv;

var resAdre;

var pos;

var latlng;

var myLatLng = {lat: 10, lng: 10};

var myCv="";

  var darkStyleArray = [
            {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
            {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
            {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
            {
              featureType: 'administrative.locality',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'poi',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'poi.park',
              elementType: 'geometry',
              stylers: [{color: '#263c3f'}]
            },
            {
              featureType: 'poi.park',
              elementType: 'labels.text.fill',
              stylers: [{color: '#6b9a76'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry',
              stylers: [{color: '#38414e'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry.stroke',
              stylers: [{color: '#212a37'}]
            },
            {
              featureType: 'road',
              elementType: 'labels.text.fill',
              stylers: [{color: '#9ca5b3'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry',
              stylers: [{color: '#746855'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry.stroke',
              stylers: [{color: '#1f2835'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'labels.text.fill',
              stylers: [{color: '#f3d19c'}]
            },
            {
              featureType: 'transit',
              elementType: 'geometry',
              stylers: [{color: '#2f3948'}]
            },
            {
              featureType: 'transit.station',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'water',
              elementType: 'geometry',
              stylers: [{color: '#17263c'}]
            },
            {
              featureType: 'water',
              elementType: 'labels.text.fill',
              stylers: [{color: '#515c6d'}]
            },
            {
              featureType: 'water',
              elementType: 'labels.text.stroke',
              stylers: [{color: '#17263c'}]
            }
          ];


function geocodeLatLng(geocoder, map, infowindow, marker) {
  
 latlng = marker.getPosition();
  geocoder.geocode({'location': latlng}, function(results, status) {

if (status === 'OK') {
      if (results[1]) {       
        console.log(results);
         resAdre = results[0].formatted_address;  
          if($("#textSearch").val() !== ""){
     var ts= " associated with the keywords: "+$("#textSearch").val();
     var tsp = $("#textSearch").val();
    }
    else{tsp = "";
          ts="";
  }
   ec = $("#countSel").val();
   ec = parseInt(ec);

     var infoWindow = new google.maps.InfoWindow({map:map});
     infoWindow.setContent('<p class="winfo">The Address found for your coordinates is '+resAdre+'. Scroll down to see the local Twitter feed</p>');
      infoWindow.setPosition(pos);
        infoWindow.open(map, marker);
        map.setCenter(latlng); 
         
         $.ajax({
               type: "POST",
               url: "https://domain/TwitterApi/LTcall",          
                data:{mylat: latlng.lat(), mylong: latlng.lng(), radiusPost: $("#radSel").val(), count: $("#countSel").val(), keyWord: tsp},
               success:function(data)
               {                            
                $("#twitterFeed").html('<div>'+data+'</div>');
                
                  var frv = myCv;
                   $("#resTitle").text("Found "+frv+" Tweets within "+$("#radSel").val()+" of "+resAdre+ts);
                }
              });
      } 
      else {
         infoWindow.setContent('<p class="winfo">No results found. Try another location</p>');
         infoWindow.open(map, marker);
         map.setCenter(latlng);      
      }
    } else {
         infoWindow.setContent('<p class="winfo">No results found. A server might be down. Please try again later</p>');
         infoWindow.open(map, marker);
         map.setCenter(latlng);     
         
    }
  });
}
          function initMap() {
        // Styles a map in night mode.   
        // var myLatLng = {lat: 0, lng: 0}; 
     var geocoder = new google.maps.Geocoder;
     var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 8,
          scrollwheel: false,
          center: myLatLng,
          styles: darkStyleArray
        });   
 mapDiv = document.getElementById('map');
      google.maps.event.addListener(mapDiv, "idle", function()
            {
              google.maps.event.trigger(map, 'resize');
            });
    $( "#mapWrap" ).resizable({handles:{ "se":"#segrip"}});             
    $( "#mapWrap" ).resize(function(){
            var center = map.getCenter();
            google.maps.event.trigger(map, 'resize');           
            map.setCenter(center);
        });             
   // Try HTML5 geolocation.
      if (navigator.geolocation) 
  {
        navigator.geolocation.getCurrentPosition(function(position) 
    {
           pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
        var posm = {
              lat: position.coords.latitude - .03,
              lng: position.coords.longitude-.02,
            };         
        var marker = new google.maps.Marker({
             position: posm,
             map: map,
             draggable:true,
             title: ''
             });
        var infowindow = new google.maps.InfoWindow({map:map});
            infowindow.setPosition(posm);
            infowindow.setContent('<p class="winfo">Your Location is '+marker.position.lat()+' lattitude and  '+marker.position.lng() +' longitude. Drag the red marker to see tweets from another location </p>');
                      
       map.setCenter(pos);
      
       geocodeLatLng(geocoder, map, infoWindow, marker);
        
       google.maps.event.addListener(marker, 'dragend', function(ev)
       {
               geocodeLatLng(geocoder, map, infoWindow, marker);
       });
       
    },     function() {
            var infoWindow = new google.maps.InfoWindow({map:map});
            handleLocationError(true, infoWindow, map.getCenter());
                      });
 }     
 else {
          // Browser doesn't support Geolocation       
          var infoWindow = new google.maps.InfoWindow({map:map});
          handleLocationError(false, infoWindow, map.getCenter());
     }
}

function initMapError() {
        // Styles a map in night mode.     
        // var myLatLng = {lat: 0, lng: 0}; LAT 0 LNG 0 CAUSES FATAL ERROR!
var geocoder = new google.maps.Geocoder;
     myLatLng = {lat: 51.6, lng: -.118};        
          emap = new google.maps.Map(document.getElementById('map'), {
              zoom: 8,
              center: myLatLng,
              styles: darkStyleArray
            });
   mapDiv = document.getElementById('map');                   
        google.maps.event.addListener(mapDiv, "idle", function()
            {
              google.maps.event.trigger(emap, 'resize');
            });
   $( "#mapWrap" ).resizable();
   $( "#mapWrap" ).resize(function(){
            var center = emap.getCenter();
            google.maps.event.trigger(emap, 'resize');                
            emap.setCenter(center);
        });

      var einfoWindow = new google.maps.InfoWindow({map:emap});
            einfoWindow.setPosition(myLatLng);
            einfoWindow.setContent('<p class="winfo">Your location couldn\'t be found please enable location services to start at your location</p>');
            
      var infoWindow = new google.maps.InfoWindow({map:emap});
            infoWindow.setPosition(myLatLng);
            infoWindow.setContent('<p class="winfo">Drag the red marker to find Address</p>');
            emap.setCenter(myLatLng);
     
      var myLatLngMark = { lat: myLatLng['lat'] - .3,
                            lng: myLatLng['lng'] - .3
        };

      var marker = new google.maps.Marker({
             position: myLatLngMark,
             map: emap,
             draggable:true,
             title: ''
             });

             google.maps.event.addListener(marker, 'dragend', function(ev){
             geocodeLatLng(geocoder, emap, infoWindow, marker);
            });         
}
    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          initMapError();
         // var infoWindow = new google.maps.InfoWindow({map:emap});
          infoWindow.setPosition(myLatLng);
          infoWindow.setContent(browserHasGeolocation ?
               alert( 'The Geolocation service failed. Please make sure location services is enabled if you\'d like to start out at your location.') :
               alert('Your browser doesn\'t seem to support geolocation services.'));
      };
          
    $("#findAddress").click(function(event){
      event.preventDefault();
        if($("#address").val()==""){
            $("#successDiv").html('<div class="alert alert-info" role="alert"> Please enter a partial address</div>');          
        }
        else{ 
    $.ajax({
        url:"https://maps.googleapis.com/maps/api/geocode/json?address="+encodeURIComponent($("#address").val())+"&key=apikey",
        type:"GET",
        success: function(data){
         // console.log(data.results[0].geometry.location);
        //console.log(data.results[0].address_components); 
          if(data.status != "OK"){
              $("#successDiv").html('<div class="alert alert-info" role="alert">Could not find Location Information for '+$("#address").val()+' please check spelling and try again</div>');
             }else{
              $.ajax({
               type: "POST",
               url: "https://domain/TwitterApi/LTcall",
               data:{mylat : data.results[0].geometry.location.lat, mylong:data.results[0].geometry.location.lng, radiusPost: $("#radSel").val()},
               success:function(data)
               {
                $("#twitterFeed").html('<div>'+data+'</div>');
                }
                });
               //console.log(data.results[0].geometry.location);
         
             $("#resTitle").text("Displaying Tweets within "+$("#radSel").val()+" of "+ data.results[0].formatted_address);
                          
             $.each(data.results[0].address_components, function(key,value){
               // console.log(data.results[0]);
                           
                    if(value.types[0]=='postal_code'){
                        $("#successDiv").html('<div class="alert alert-success" role="alert">Results found for '+data.results[0].formatted_address+' the zipcode for this location is '+value.long_name+'</div>');
                }          
            });
          }
        }       
    });
  }
});

 var ec
 $('#reForm').on('submit', function(e) {
    e.preventDefault();
      if($("#textSearch").val() !== undefined){
     var ts= " associated with the keywords: "+$("#textSearch").val();
     var tsp = $("#textSearch").val();
    }
    else{
      tsp = "";
    }
   ec = $("#countSel").val(); 
   ec = parseInt(ec);
 
$.ajax({
     type: "POST",
     url: "https://domain/TwitterApi/LTcall",
     data:{mylat: latlng.lat(), mylong: latlng.lng(), radiusPost: $("#radSel").val(), count: $("#countSel").val(), keyWord: tsp},
     success:function(data)
     {
      $("#twitterFeed").html('<div>'+data+'</div>');
        var frv =  myCv;
                   $("#resTitle").text("Found "+frv+" Tweets within "+$("#radSel").val()+" of "+resAdre+ts);
        // location.href = "/index.html#feedZone";              
              }
          })
      });
</script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=privatekey&callback=initMap">
  </script>
 </body>
</html>
